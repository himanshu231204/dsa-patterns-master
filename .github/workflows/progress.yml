name: Update Progress

on:
  push:
    paths:
      - "README.md"

jobs:
  update-progress:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Count completed tasks
        run: |
          TOTAL=$(grep -E "^- \[[ x]\]" README.md | wc -l)
          DONE=$(grep -E "^- \[x\]" README.md | wc -l)

          if [ "$TOTAL" -eq 0 ]; then
            PERCENT=0
          else
            PERCENT=$((DONE * 100 / TOTAL))
          fi

          echo "TOTAL=$TOTAL" >> $GITHUB_ENV
          echo "DONE=$DONE" >> $GITHUB_ENV
          echo "PERCENT=$PERCENT" >> $GITHUB_ENV

      - name: Update README
        run: |
          sed -i "/<!-- PROGRESS_START -->/,/<!-- PROGRESS_END -->/c\
<!-- PROGRESS_START -->\n\n## ðŸ“Š Overall Progress\n\n$DONE / $TOTAL Problems Completed\n\n![Progress](https://progress-bar.dev/$PERCENT/?title=Completed)\n\n<!-- PROGRESS_END -->" README.md

      - name: Commit changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add README.md
          git commit -m "Auto-update progress" || echo "No changes"
          git push